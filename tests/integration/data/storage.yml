cases:
  # ============================================================
  # CASE 1: storage_001 - Create dir storage with update
  # ============================================================
  - name: storage_001
    pillars:
      incus:
        storage_pools:
          pool-dir:
            ensure: present
            driver: dir
            config:
              source: /var/lib/incus/storage-pools/pool-dir
            description: Test dir storage pool
            update_config:
              volume.size: 10GiB
            update_description: Updated
    command: state.apply storage
    expected:
      salt_output_contains:
        - "pool-dir"
        - "changes"
      local_shell:
        - cmd: incus storage show pool-dir
          expect_stdout:
            - "driver: dir"
            - "source: /var/lib/incus/storage-pools/local"
    cleanup:
      - incus storage delete pool-dir

  # ============================================================
  # CASE 2: storage_002 - Delete zfs storage
  # ============================================================
  - name: storage_002
    pillars:
      incus:
        storage_pools:
          pool-zfs:
            ensure: absent
            driver: zfs
            config:
              source: tank/incus
              volume.zfs.remove_snapshots: 'true'
              volume.zfs.use_refquota: 'true'
            description: Test zfs storage pool
    command: state.apply storage
    expected:
      salt_output_contains:
        - "pool-zfs"

  # ============================================================
  # CASE 3: storage_003 - Delete lvm storage
  # ============================================================
  - name: storage_003
    pillars:
      incus:
        storage_pools:
          pool-lvm:
            ensure: absent
            driver: lvm
            config:
              source: /dev/sdb
              lvm.vg_name: incus-vg
              volume.block.filesystem: ext4
            description: Test lvm storage pool
    command: state.apply storage
    expected:
      salt_output_contains:
        - "pool-lvm"

  # ============================================================
  # CASE 4: storage_004 - Create btrfs storage
  # ============================================================
  - name: storage_004
    pillars:
      incus:
        storage_pools:
          pool-btrfs:
            ensure: present
            driver: btrfs
            config:
              source: /var/lib/incus/storage-pools/btrfs
            description: Test btrfs storage pool
    command: state.apply storage
    expected:
      salt_output_contains:
        - "pool-btrfs"
        - "changes"
      local_shell:
        - cmd: incus storage show pool-btrfs
          expect_stdout:
            - "driver: btrfs"
    cleanup:
      - incus storage delete pool-btrfs

  # ============================================================
  # CASE 5: storage_005 - Create ceph storage
  # ============================================================
  - name: storage_005
    pillars:
      incus:
        storage_pools:
          pool-ceph:
            ensure: present
            driver: ceph
            config:
              source: incus
              ceph.cluster_name: ceph
              ceph.osd.pg_num: '32'
              ceph.user.name: admin
            description: Test ceph storage pool
    command: state.apply storage
    expected:
      salt_output_contains:
        - "pool-ceph"
        - "changes"
      local_shell:
        - cmd: incus storage show pool-ceph
          expect_stdout:
            - "driver: ceph"
            - "ceph.cluster_name: ceph"
    cleanup:
      - incus storage delete pool-ceph

  # ============================================================
  # CASE 6: storage_006 - Delete ceph storage
  # ============================================================
  - name: storage_006
    pillars:
      incus:
        storage_pools:
          pool-ceph:
            ensure: absent
            driver: ceph
            config:
              source: incus
              ceph.cluster_name: ceph
              ceph.osd.pg_num: '32'
              ceph.user.name: admin
            description: Test ceph storage pool
    command: state.apply storage
    expected:
      salt_output_contains:
        - "pool-ceph"

  # ============================================================
  # CASE 7: storage_007 - Delete btrfs storage
  # ============================================================
  - name: storage_007
    pillars:
      incus:
        storage_pools:
          pool-btrfs:
            ensure: absent
            driver: btrfs
            config:
              source: /var/lib/incus/storage-pools/btrfs
            description: Test btrfs storage pool
    command: state.apply storage
    expected:
      salt_output_contains:
        - "pool-btrfs"

  # ============================================================
  # CASE 8: storage_008 - Create lvm storage with update
  # ============================================================
  - name: storage_008
    pillars:
      incus:
        storage_pools:
          pool-lvm:
            ensure: present
            driver: lvm
            config:
              source: /dev/sdb
              lvm.vg_name: incus-vg
              volume.block.filesystem: ext4
            description: Test lvm storage pool
            update_config:
              volume.size: 10GiB
            update_description: Updated
    command: state.apply storage
    expected:
      salt_output_contains:
        - "pool-lvm"
        - "changes"
      local_shell:
        - cmd: incus storage show pool-lvm
          expect_stdout:
            - "driver: lvm"
            - "lvm.vg_name: incus-vg"
    cleanup:
      - incus storage delete pool-lvm

  # ============================================================
  # CASE 9: storage_009 - Create zfs storage
  # ============================================================
  - name: storage_009
    pillars:
      incus:
        storage_pools:
          pool-zfs:
            ensure: present
            driver: zfs
            config:
              source: tank/incus
              volume.zfs.remove_snapshots: 'true'
              volume.zfs.use_refquota: 'true'
            description: Test zfs storage pool
    command: state.apply storage
    expected:
      salt_output_contains:
        - "pool-zfs"
        - "changes"
      local_shell:
        - cmd: incus storage show pool-zfs
          expect_stdout:
            - "driver: zfs"
            - "source: tank/incus"
    cleanup:
      - incus storage delete pool-zfs

  # ============================================================
  # CASE 10: storage_010 - Delete dir storage
  # ============================================================
  - name: storage_010
    pillars:
      incus:
        storage_pools:
          pool-dir:
            ensure: absent
            driver: dir
            config:
              source: /var/lib/incus/storage-pools/local
            description: Test dir storage pool
    command: state.apply storage
    expected:
      salt_output_contains:
        - "pool-dir"
